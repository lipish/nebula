import { createContext, useContext, useMemo, useState } from 'react'
import type { ReactNode } from 'react'

export type Locale = 'zh' | 'en'

interface I18nContextValue {
  locale: Locale
  setLocale: (locale: Locale) => void
  t: (key: string, vars?: Record<string, string | number>) => string
}

const STORAGE_KEY = 'nebula_locale'

const messages: Record<Locale, Record<string, string>> = {
  zh: {
    'common.loading': '加载中...',
    'common.refresh': '刷新',
    'common.search': '搜索',
    'common.actions': '操作',
    'common.status': '状态',
    'common.total': '总计',
    'common.cancel': '取消',
    'common.save': '保存',
    'common.delete': '删除',
    'common.enable': '启用',
    'common.disable': '禁用',
    'common.details': '详情',
    'common.all': '全部',
    'common.back': '返回',
    'common.n_a': '无',

    'lang.zh': '中文',
    'lang.en': 'English',
    'lang.switch': '语言',

    'nav.dashboard': '总览',
    'nav.models': '模型服务',
    'nav.inference': '推理',
    'nav.endpoints': '端点',
    'nav.nodes': '节点与 GPU',
    'nav.images': '镜像',
    'nav.templates': '模板',
    'nav.catalog': '模型目录',
    'nav.library': '模型库',
    'nav.audit': '审计日志',
    'nav.settings': '设置',
    'nav.help': '帮助',
    'nav.feedback': '反馈',
    'nav.workbench': '工作台',
    'nav.infrastructure': '基础设施',
    'nav.resources': '资源',
    'nav.system': '系统',

    'app.loadingSession': '正在加载会话...',
    'app.searchPlaceholder': '搜索模型、节点...',
    'app.account': '账户',
    'app.editProfile': '编辑资料',
    'app.accountSettings': '账户设置',
    'app.logout': '退出登录',

    'login.title': '登录',
    'login.subtitle': '输入凭据以访问平台',
    'login.email': '邮箱',
    'login.password': '密码',
    'login.remember': '记住我',
    'login.forgot': '忘记密码？',
    'login.signingIn': '登录中...',
    'login.signIn': '登录',
    'login.noAccount': '还没有账号？',
    'login.contactAdmin': '联系管理员',
    'login.demo': '演示账号：admin / admin123',
    'login.failed': '登录失败',
    'login.heroTitle': '企业级 AI 模型管理平台',
    'login.heroDesc': '自信地部署、管理与扩展你的 AI 模型。为追求稳定可靠的团队打造。',

    'models.title': '模型服务',
    'models.subtitle': '管理运行中的模型服务与部署生命周期',
    'models.loadModel': '加载模型',
    'models.tableTitle': '模型列表',
    'models.tableDesc': '来自 v2 API 的聚合模型状态',
    'models.loading': '正在加载模型…',
    'models.empty': '未找到模型。',
    'models.copyFail': '复制模型名失败',
    'models.failedLoad': '加载模型失败',
    'models.actionFailed': '操作失败',
    'models.start': '启动',
    'models.stopService': '停止服务',
    'models.delete': '删除',
    'models.unhealthy': '不健康',
    'models.model': '模型',
    'models.state': '状态',
    'models.replicas': '副本',
    'models.engine': '引擎',

    'state.running': '运行中',
    'state.stopped': '已停止',
    'state.downloading': '下载中',
    'state.starting': '启动中',
    'state.degraded': '降级',
    'state.failed': '失败',
    'state.stopping': '停止中',

    'profile.title': '编辑资料',
    'profile.subtitle': '更新你的基本资料信息。',
    'profile.details': '资料详情',
    'profile.displayName': '显示名称',
    'profile.email': '邮箱',
    'profile.emailPlaceholder': 'name@company.com',
    'profile.namePlaceholder': '你的姓名',
    'profile.saveChanges': '保存修改',
    'profile.saving': '保存中...',
    'profile.saved': '已保存',
    'profile.saveFailed': '保存资料失败',
    'profile.persistHint': '资料数据已持久化到后端 PostgreSQL。',

    'account.title': '账户设置',
    'account.subtitle': '管理账户偏好与安全选项。',
    'account.preferences': '偏好设置',
    'account.loading': '正在加载设置...',
    'account.loadFailed': '加载账户设置失败',
    'account.saveFailed': '保存偏好失败',
    'account.createFailed': '创建用户失败',
    'account.updateFailed': '更新用户失败',
    'account.deleteFailed': '删除用户失败',
    'account.inAppAlerts': '站内提醒',
    'account.inAppDesc': '在右上角铃铛中显示告警指示。',
    'account.emailAlerts': '邮件提醒',
    'account.emailDesc': '通过邮件接收关键通知。',
    'account.pgHint': '用户资料/账户设置持久化在 PostgreSQL，并在会话间共享。',
    'account.openSecurity': '打开安全设置',
    'account.savePreferences': '保存偏好',
    'account.saved': '已保存',
    'account.userManagement': '用户管理',
    'account.createUser': '创建用户',
    'account.admin': '管理员',
    'account.username': '用户名',
    'account.password': '密码',
    'account.roleViewer': '访客',
    'account.roleOperator': '运维',
    'account.roleAdmin': '管理员',
    'account.backendStatus': '后端状态',
    'account.backendDesc': '用户认证/资料/设置现由后端 PostgreSQL API 提供。',
    'account.active': '启用',
    'account.disabled': '禁用',

    'settings.title': '设置',
    'settings.subtitle': '管理平台偏好与安全',
    'settings.auth': '认证',
    'settings.authDesc': '由后端 PostgreSQL 认证服务管理',
    'settings.serverManaged': '服务端托管',
    'settings.sessionAuth': '会话认证',
    'settings.sessionDesc': '当前会话令牌由后端登录 API 签发，并在 PostgreSQL 会话中校验。',
    'settings.refreshProtected': '刷新受保护数据',
    'settings.systemInfo': '系统信息',
    'settings.uiVersion': '界面版本',
    'settings.apiTier': 'API 层级',

    'dashboard.title': '总览',
    'dashboard.subtitle': '查看集群健康状态与活跃模型概况',
    'dashboard.gpuMemory': 'GPU 显存',
    'dashboard.high': '高',
    'dashboard.healthy': '健康',
    'dashboard.avgUtilization': '平均利用率',
    'dashboard.maxTemperature': '最高温度',
    'dashboard.hot': '过热',
    'dashboard.activeEndpoints': '活跃端点',
    'dashboard.gpuMemoryUsage': 'GPU 显存使用',
    'dashboard.total': '总计',
    'dashboard.noGpuData': '暂无 GPU 数据。',
    'dashboard.gpuTrend': 'GPU 趋势（1小时）',
    'dashboard.fromXtrace': '来自 xtrace 指标',
    'dashboard.noTrendData': '暂无趋势数据。xtrace 采集后会显示。',
    'dashboard.noEndpointsOnline': '暂无在线端点。请先加载模型。',
    'dashboard.critical': '严重',
    'dashboard.warning': '警告',
    'dashboard.gpusAcrossNodes': '{{gpus}} 张 GPU，分布在 {{nodes}} 个节点',
    'dashboard.activeEndpointsCount': '{{count}} 个活跃端点',
    'dashboard.modelRequestsCount': '{{count}} 个模型请求',
    'dashboard.used': '已用',
    'dashboard.free': '空闲',
    'dashboard.utilizationPct': '利用率 %',
    'dashboard.tempC': '温度 °C',

    'nodes.title': '节点与 GPU',
    'nodes.subtitle': '监控计算基础设施和 GPU 资源',
    'nodes.emptyTitle': '未检测到节点',
    'nodes.emptyDesc': '请确保你的计算服务器上运行了 nebula-node 进程并向 etcd 发送心跳。',
    'nodes.heartbeat': '心跳',
    'nodes.online': '在线',
    'nodes.vramUsage': '显存使用',
    'nodes.temp': '温度',
    'nodes.util': '利用率',
    'nodes.workload': '负载',
    'nodes.available': '可用',

    'endpoints.title': '端点',
    'endpoints.subtitle': '管理并监控模型服务实例',
    'endpoints.total': '端点总数',
    'endpoints.activeGpus': '活跃 GPU',
    'endpoints.totalVram': '已用总显存',
    'endpoints.searchPlaceholder': '搜索端点...',
    'endpoints.allStatus': '全部状态',
    'endpoints.notFound': '未找到端点',
    'endpoints.endpoint': '端点',
    'endpoints.nodeGpu': '节点 / GPU',
    'endpoints.vram': '显存',
    'endpoints.kvCache': 'KV 缓存',
    'endpoints.pending': '排队',
    'endpoints.engine': '引擎',
    'endpoints.replicas': '副本',
    'endpoints.replica': '副本',

    'audit.title': '审计日志',
    'audit.subtitle': '追踪平台上的操作人、操作内容与时间',
    'audit.failedLoad': '加载审计日志失败',
    'audit.filterByPrincipal': '按主体过滤...',
    'audit.noData': '未找到审计日志',
    'audit.time': '时间',
    'audit.principal': '主体',
    'audit.role': '角色',
    'audit.action': '动作',
    'audit.latency': '延迟',
    'audit.page': '第 {{page}} / {{total}} 页',

    'modelDetail.failedLoad': '加载模型失败',
    'modelDetail.actionFailed': '操作失败',
    'modelDetail.loading': '正在加载模型…',
    'modelDetail.replicas': '副本',
    'modelDetail.engine': '引擎',
    'modelDetail.created': '创建时间',
    'modelDetail.updated': '更新时间',
    'modelDetail.downloadProgress': '下载进度',
    'modelDetail.deployment': '部署',
    'modelDetail.desiredState': '目标状态',
    'modelDetail.version': '版本',
    'modelDetail.nodeAffinity': '节点亲和',
    'modelDetail.gpuAffinity': 'GPU 亲和',
    'modelDetail.endpoints': '端点',
    'modelDetail.kind': '类型',
    'modelDetail.baseUrl': '基础地址',
    'modelDetail.cacheStatus': '缓存状态',
    'modelDetail.totalSize': '总大小',
    'modelDetail.cachedOn': '缓存节点',
    'modelDetail.noNodes': '无节点',
    'modelDetail.labels': '标签',

    'images.title': '镜像仓库',
    'images.subtitle': '管理集群内引擎 Docker 镜像',
    'images.register': '注册镜像',
    'images.registered': '已注册镜像',
    'images.noData': '暂未注册任何镜像。',
    'images.failedLoad': '加载镜像失败',
    'images.editImage': '编辑镜像',
    'images.registerNewImage': '注册新镜像',
    'images.imageId': '镜像 ID',
    'images.imageIdPlaceholder': '例如：vllm-cuda124',
    'images.engineType': '引擎类型',
    'images.versionPolicy': '版本策略',
    'images.pinStable': '固定（稳定）',
    'images.rollingLatest': '滚动（最新）',
    'images.dockerImage': 'Docker 镜像',
    'images.dockerImagePlaceholder': '例如：vllm/vllm-openai:v0.8.3',
    'images.platforms': '平台',
    'images.platformsHint': '逗号分隔，留空表示全部',
    'images.platformsPlaceholder': '例如：nvidia-cuda, ascend-cann8',
    'images.autoPrePull': '在匹配节点自动预拉取',
    'images.update': '更新',

    'templates.title': '模型模板',
    'templates.subtitle': '使用预配置模板快速部署模型',
    'templates.available': '可用模板',
    'templates.noData': '暂无可用模板。',
    'templates.deploy': '部署',
    'templates.failedLoad': '加载模板失败',
    'templates.deployFailed': '部署模板失败',
    'templates.name': '名称',
    'templates.description': '描述',
    'templates.category': '分类',
    'templates.modelUid': '模型 UID',
    'templates.optionalOverride': '可选覆盖',
    'templates.leaveEmptyAuto': '留空则自动生成',
    'templates.nodeId': '节点 ID',
    'templates.optional': '可选',
    'templates.gpuIndices': 'GPU 索引',
    'templates.commaSeparated': '逗号分隔',
    'templates.gpuExample': '例如：0, 1',
    'templates.deployTemplateTitle': '部署模板：{{name}}',

    'catalog.title': '模型目录',
    'catalog.subtitle': '从 Hugging Face 或 ModelScope 搜索并导入模型',
    'catalog.downloadedModels': '已下载模型',
    'catalog.browse': '浏览与下载',
    'catalog.source': '来源',
    'catalog.searchModel': '搜索模型',
    'catalog.task': '任务',
    'catalog.allTasks': '全部任务',
    'catalog.searching': '正在搜索模型...',
    'catalog.empty': '当前筛选条件下未找到模型。',
    'catalog.downloaded': '已下载',
    'catalog.searchPlaceholder': '搜索模型，例如：Qwen2.5-7B、bge-m3、llama...',
    'catalog.downloads': '下载量',
    'catalog.likes': '点赞',
    'catalog.downloadTask': '下载任务',
    'catalog.submitted': '已提交',
    'catalog.openStatus': '打开状态',
    'catalog.dismiss': '关闭',
    'catalog.import': '导入',
    'catalog.imported': '已导入',
    'catalog.downloadModel': '下载模型',
    'catalog.modelUidOptional': '模型 UID（可选）',
    'catalog.autoGenerated': '自动生成',
    'catalog.downloadPathOptional': '下载路径（可选）',
    'catalog.pathHint': '留空时，Nebula 使用节点默认模型目录。',
    'catalog.downloading': '下载中...',
    'catalog.startDownload': '开始下载',

    'library.title': '模型库',
    'library.subtitle': '管理已下载模型资产与存储路径',
    'library.assets': '已下载资产',
    'library.models': '模型',
    'library.loading': '正在加载模型库…',
    'library.empty': '未找到已下载模型。',
    'library.openService': '打开服务',
    'library.move': '迁移',
    'library.pending': '待下载',
    'library.assetStatus': '资产状态',
    'library.serviceStatus': '服务状态',
    'library.cachedNodes': '缓存节点：{{count}}',
    'library.moveStoragePath': '迁移存储路径',
    'library.newPath': '新路径',
    'library.newPathPlaceholder': '例如：/DATA/Model 或 /mnt/models',
    'library.movePathHint': '将更新模型后续下载/存储的路径配置。',

    'inference.title': '推理',
    'inference.subtitle': '监控实时推理性能与网关指标',
    'inference.overloadDetected': '检测到过载',
    'inference.overloadDesc': '以下模型的所有端点均过载（KV 缓存 >95%）：{{models}}。新请求将返回 429。',
    'inference.totalRequests': '总请求数',
    'inference.inFlight': '处理中',
    'inference.activeEndpoints': '活跃端点',
    'inference.successRate': '成功率',
    'inference.authMissing': '缺少认证',
    'inference.authInvalid': '认证无效',
    'inference.authForbidden': '权限不足',
    'inference.authRateLimited': '限流',
    'inference.perModelRouting': '按模型路由指标',
    'inference.perModelRoutingDesc': '来自 Router 的端到端延迟、TTFT 与请求统计',
    'inference.requests': '请求数',
    'inference.avgLatency': '平均延迟',
    'inference.avgTtft': '平均 TTFT',
    'inference.engineStats': '引擎指标',
    'inference.engineStatsDesc': '每个端点的 KV 缓存与排队请求情况',
    'inference.kvCache': 'KV 缓存',
    'inference.pending': '排队',
    'inference.prefixCacheHit': '前缀缓存命中',
    'inference.responseStatus': '响应状态',
    'inference.responseStatusDesc': '按 HTTP 状态码统计',
    'inference.authEvents': '认证事件',
    'inference.authEventsDesc': '认证与鉴权失败统计',
    'inference.count': '数量',
    'inference.activeEndpointsDesc': '当前正在提供推理服务的模型实例',
    'inference.replica': '副本',
    'inference.node': '节点',
    'inference.baseUrl': '基础地址',
    'inference.noActiveEndpoints': '暂无活跃端点',

    'loadDialog.title.search': '搜索并选择模型',
    'loadDialog.title.templates': '从模板部署',
    'loadDialog.title.configure': '配置部署',
    'loadDialog.desc.search': '从 HuggingFace 或 ModelScope 搜索模型',
    'loadDialog.desc.templates': '选择预配置模板快速部署',
    'loadDialog.desc.configure': '部署 {{model}}',
    'loadDialog.searchPlaceholder': '搜索模型，例如：Qwen2.5、Llama、DeepSeek...',
    'loadDialog.searching': '搜索中...',
    'loadDialog.noModelsFound': '未找到模型，请尝试其他关键词。',
    'loadDialog.popularModels': '热门模型',
    'loadDialog.manualEntry': '或手动输入模型路径 →',
    'loadDialog.fromTemplate': '从模板部署',
    'loadDialog.backToSearch': '返回搜索',
    'loadDialog.loadingTemplates': '正在加载模板...',
    'loadDialog.noTemplates': '暂无可用模板。',
    'loadDialog.deployFailed': '部署失败',
    'loadDialog.targetHardware': '目标硬件',
    'loadDialog.gpuTensorParallel': '{{count}} 张 GPU · 张量并行',
    'loadDialog.vramHint': '百分比为已用占比。红色表示显存占用高（>80%）或剩余显存过低；“占用中”表示该 GPU 已被现有部署占用。',
    'loadDialog.occupiedModels': '已占用模型',
    'loadDialog.unloadToFreeGpus': '卸载以释放 GPU',
    'loadDialog.unload': '卸载',
    'loadDialog.noUnloadablePlacements': '未找到可卸载部署（缺少 request_id）。',
    'loadDialog.freeTotal': '空闲 {{free}} GB（总计 {{total}} GB）',
    'loadDialog.usedPct': '已用 {{value}}%',
    'loadDialog.lowVram': '显存不足，模型可能加载失败',
    'loadDialog.inUse': '占用中',
    'loadDialog.multiGpuAutoTensor': '已选择多 GPU，将自动设置 tensor_parallel_size = {{count}}。',
    'loadDialog.defaultNodeCli': '默认（节点 CLI 配置）',
    'loadDialog.noRegisteredImages': '{{engine}} 暂无已注册镜像，将使用节点默认配置。请在“镜像”页面注册。',
    'loadDialog.modelPath': '模型路径',
    'loadDialog.modelPathPlaceholder': '例如：Qwen/Qwen2.5-0.5B-Instruct',
    'loadDialog.ggufHint': 'GGUF 需要本地 .gguf 文件路径（例如 /DATA/Model/.../*.gguf）。',
    'loadDialog.deploymentUid': '部署 UID',
    'loadDialog.deploymentUidPlaceholder': '例如：qwen2.5-7b',
    'loadDialog.contextWindow': '上下文窗口',
    'loadDialog.deploying': '部署中...',
    'loadDialog.launchModel': '启动模型',
  },
  en: {
    'common.loading': 'Loading...',
    'common.refresh': 'Refresh',
    'common.search': 'Search',
    'common.actions': 'Actions',
    'common.status': 'Status',
    'common.total': 'Total',
    'common.cancel': 'Cancel',
    'common.save': 'Save',
    'common.delete': 'Delete',
    'common.enable': 'Enable',
    'common.disable': 'Disable',
    'common.details': 'Details',
    'common.all': 'All',
    'common.back': 'Back',
    'common.n_a': 'n/a',

    'profile.emailPlaceholder': 'name@company.com',

    'account.admin': 'Admin',
    'account.username': 'Username',
    'account.password': 'Password',
    'account.roleViewer': 'viewer',
    'account.roleOperator': 'operator',
    'account.roleAdmin': 'admin',

    'lang.zh': '中文',
    'lang.en': 'English',
    'lang.switch': 'Language',

    'dashboard.gpuMemory': 'GPU Memory',
    'dashboard.high': 'High',
    'dashboard.healthy': 'Healthy',
    'dashboard.avgUtilization': 'Avg Utilization',
    'dashboard.maxTemperature': 'Max Temperature',
    'dashboard.hot': 'Hot',
    'dashboard.activeEndpoints': 'Active Endpoints',
    'dashboard.gpuMemoryUsage': 'GPU Memory Usage',
    'dashboard.total': 'total',
    'dashboard.noGpuData': 'No GPU data available.',
    'dashboard.gpuTrend': 'GPU Trend (1h)',
    'dashboard.fromXtrace': 'from xtrace metrics',
    'dashboard.noTrendData': 'No trend data yet. Metrics will appear after xtrace collects data.',
    'dashboard.noEndpointsOnline': 'No endpoints online. Load a model to get started.',
    'dashboard.critical': 'critical',
    'dashboard.warning': 'warning',
    'dashboard.gpusAcrossNodes': '{{gpus}} GPUs across {{nodes}} nodes',
    'dashboard.activeEndpointsCount': '{{count}} active endpoints',
    'dashboard.modelRequestsCount': '{{count}} model requests',
    'dashboard.used': 'Used',
    'dashboard.free': 'Free',
    'dashboard.utilizationPct': 'Utilization %',
    'dashboard.tempC': 'Temp °C',

    'library.pending': 'Pending',
    'library.assetStatus': 'Asset Status',
    'library.serviceStatus': 'Service Status',
    'library.cachedNodes': 'cached nodes: {{count}}',
    'library.moveStoragePath': 'Move Storage Path',
    'library.newPath': 'New Path',
    'library.newPathPlaceholder': 'e.g. /DATA/Model or /mnt/models',
    'library.movePathHint': 'This updates model download/storage path configuration for subsequent operations.',

    'images.editImage': 'Edit Image',
    'images.registerNewImage': 'Register New Image',
    'images.imageId': 'Image ID',
    'images.imageIdPlaceholder': 'e.g. vllm-cuda124',
    'images.engineType': 'Engine Type',
    'images.versionPolicy': 'Version Policy',
    'images.pinStable': 'Pin (stable)',
    'images.rollingLatest': 'Rolling (latest)',
    'images.dockerImage': 'Docker Image',
    'images.dockerImagePlaceholder': 'e.g. vllm/vllm-openai:v0.8.3',
    'images.platforms': 'Platforms',
    'images.platformsHint': 'comma-separated, empty = all',
    'images.platformsPlaceholder': 'e.g. nvidia-cuda, ascend-cann8',
    'images.autoPrePull': 'Auto pre-pull on matching nodes',
    'images.update': 'Update',

    'templates.deployFailed': 'Failed to deploy template',
    'templates.name': 'Name',
    'templates.description': 'Description',
    'templates.category': 'Category',
    'templates.modelUid': 'Model UID',
    'templates.optionalOverride': 'optional override',
    'templates.leaveEmptyAuto': 'Leave empty to auto-generate',
    'templates.nodeId': 'Node ID',
    'templates.optional': 'Optional',
    'templates.gpuIndices': 'GPU Indices',
    'templates.commaSeparated': 'comma-separated',
    'templates.gpuExample': 'e.g. 0, 1',
    'templates.deployTemplateTitle': 'Deploy Template: {{name}}',

    'catalog.searchPlaceholder': 'Search models, e.g. Qwen2.5-7B, bge-m3, llama...',
    'catalog.downloads': 'Downloads',
    'catalog.likes': 'Likes',
    'catalog.downloadTask': 'Download Task',
    'catalog.submitted': 'submitted',
    'catalog.openStatus': 'Open Status',
    'catalog.dismiss': 'Dismiss',
    'catalog.import': 'Import',
    'catalog.imported': 'Imported',
    'catalog.downloadModel': 'Download Model',
    'catalog.modelUidOptional': 'Model UID (optional)',
    'catalog.autoGenerated': 'auto-generated',
    'catalog.downloadPathOptional': 'Download Path (optional)',
    'catalog.pathHint': 'If empty, Nebula uses the node default model directory.',
    'catalog.downloading': 'Downloading...',
    'catalog.startDownload': 'Start Download',

    'inference.overloadDetected': 'Overload Detected',
    'inference.overloadDesc': 'All endpoints overloaded (KV cache >95%) for: {{models}}. New requests will receive 429 responses.',
    'inference.totalRequests': 'Total Requests',
    'inference.inFlight': 'In-Flight',
    'inference.activeEndpoints': 'Active Endpoints',
    'inference.successRate': 'Success Rate',
    'inference.authMissing': 'Missing',
    'inference.authInvalid': 'Invalid',
    'inference.authForbidden': 'Forbidden',
    'inference.authRateLimited': 'Rate Limited',
    'inference.perModelRouting': 'Per-Model Routing Metrics',
    'inference.perModelRoutingDesc': 'E2E latency, TTFT, and request counts from the Router',
    'inference.requests': 'Requests',
    'inference.avgLatency': 'Avg Latency',
    'inference.avgTtft': 'Avg TTFT',
    'inference.engineStats': 'Engine Stats',
    'inference.engineStatsDesc': 'KV cache usage and pending requests per endpoint',
    'inference.kvCache': 'KV Cache',
    'inference.pending': 'Pending',
    'inference.prefixCacheHit': 'Prefix Cache Hit',
    'inference.responseStatus': 'Response Status',
    'inference.responseStatusDesc': 'Breakdown by HTTP status code',
    'inference.authEvents': 'Auth Events',
    'inference.authEventsDesc': 'Authentication and authorization failures',
    'inference.count': 'Count',
    'inference.activeEndpointsDesc': 'Model instances currently serving inference',
    'inference.replica': 'Replica',
    'inference.node': 'Node',
    'inference.baseUrl': 'Base URL',
    'inference.noActiveEndpoints': 'No active endpoints',

    'loadDialog.title.search': 'Search & Select Model',
    'loadDialog.title.templates': 'Deploy from Template',
    'loadDialog.title.configure': 'Configure Deployment',
    'loadDialog.desc.search': 'Search models from HuggingFace or ModelScope',
    'loadDialog.desc.templates': 'Choose a pre-configured template to deploy',
    'loadDialog.desc.configure': 'Deploy {{model}}',
    'loadDialog.searchPlaceholder': 'Search models, e.g. Qwen2.5, Llama, DeepSeek...',
    'loadDialog.searching': 'Searching...',
    'loadDialog.noModelsFound': 'No models found. Try a different keyword.',
    'loadDialog.popularModels': 'Popular Models',
    'loadDialog.manualEntry': 'Or enter model path manually →',
    'loadDialog.fromTemplate': 'From Template',
    'loadDialog.backToSearch': 'Back to search',
    'loadDialog.loadingTemplates': 'Loading templates...',
    'loadDialog.noTemplates': 'No templates available yet.',
    'loadDialog.deployFailed': 'Deploy failed',
    'loadDialog.targetHardware': 'Target Hardware',
    'loadDialog.gpuTensorParallel': '{{count}} GPUs · Tensor Parallel',
    'loadDialog.vramHint': 'Percent means used%. Red indicates high VRAM usage (>80% used) or low free VRAM. “IN USE” means occupied by an existing placement.',
    'loadDialog.occupiedModels': 'Occupied Models',
    'loadDialog.unloadToFreeGpus': 'Unload to free GPUs',
    'loadDialog.unload': 'Unload',
    'loadDialog.noUnloadablePlacements': 'No unloadable placements found (missing request_id).',
    'loadDialog.freeTotal': 'Free {{free}} GB (Total {{total}} GB)',
    'loadDialog.usedPct': '{{value}}% used',
    'loadDialog.lowVram': 'Low VRAM — model may fail to load',
    'loadDialog.inUse': 'IN USE',
    'loadDialog.multiGpuAutoTensor': 'Multi-GPU selected — tensor_parallel_size will be set to {{count}} automatically.',
    'loadDialog.defaultNodeCli': 'Default (node CLI config)',
    'loadDialog.noRegisteredImages': 'No registered images for {{engine}}. Will use node default config. Register images in the Images page.',
    'loadDialog.modelPath': 'Model Path',
    'loadDialog.modelPathPlaceholder': 'e.g. Qwen/Qwen2.5-0.5B-Instruct',
    'loadDialog.ggufHint': 'GGUF requires a local .gguf file path (e.g. /DATA/Model/.../*.gguf).',
    'loadDialog.deploymentUid': 'Deployment UID',
    'loadDialog.deploymentUidPlaceholder': 'e.g. qwen2.5-7b',
    'loadDialog.contextWindow': 'Context Window',
    'loadDialog.deploying': 'Deploying...',
    'loadDialog.launchModel': 'Launch Model',
  },
}

const I18nContext = createContext<I18nContextValue | null>(null)

const interpolate = (template: string, vars?: Record<string, string | number>) => {
  if (!vars) return template
  return template.replace(/\{\{(\w+)\}\}/g, (_, key: string) => String(vars[key] ?? ''))
}

export function I18nProvider({ children }: { children: ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>(() => {
    const saved = localStorage.getItem(STORAGE_KEY)
    return saved === 'en' || saved === 'zh' ? saved : 'zh'
  })

  const setLocale = (next: Locale) => {
    setLocaleState(next)
    localStorage.setItem(STORAGE_KEY, next)
    document.documentElement.lang = next === 'zh' ? 'zh-CN' : 'en'
  }

  const value = useMemo<I18nContextValue>(() => ({
    locale,
    setLocale,
    t: (key: string, vars?: Record<string, string | number>) => {
      const msg = messages[locale][key] ?? messages.zh[key] ?? messages.en[key] ?? key
      return interpolate(msg, vars)
    },
  }), [locale])

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
}

export function useI18n() {
  const ctx = useContext(I18nContext)
  if (!ctx) {
    throw new Error('useI18n must be used within I18nProvider')
  }
  return ctx
}
